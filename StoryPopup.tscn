[gd_scene load_steps=2 format=3 uid="uid://b61tqs4j56k27"]

[sub_resource type="GDScript" id="GDScript_c65jr"]
script/source = "extends CanvasLayer

signal popup_closed

# Node references - will be found in _ready
var continue_button: Button
var story_label: RichTextLabel

# The full story text with RichText markup for formatting:
const STORY_TEXT = \"\"\"[center][b][font_size=24]ü§ñ ANGRY ROBOTS: SYSTEM RESTORE[/font_size][/b][/center]

[b][color=#55aaff]üõ°Ô∏è MISSION BRIEFING[/color][/b]
You are Unit-07, a critical service robot and one of the last operational systems after the central network was infected by a malicious AI: the [color=#ff5555][b]GLITCH KING[/b][/color].

This virus has corrupted all service bots, turning them into hostile \"Angry Robots.\" Your mission: fight through [b]FOUR corrupted sectors[/b] and [color=#55ff55][b]DELETE THE GLITCH KING[/b][/color].

[b][color=#ffaa55]üåê BATTLEFIELD RESOURCES[/color][/b]
[indent]‚Ä¢ [color=#ffff55][b]Core Data Fragments (Orbs):[/b][/color] Collect these to patch corrupted subroutines and access the next sector.

‚Ä¢ [color=#aaaaaa][b]Scrap Gears (Currency):[/b][/color] Trade with the Clanker Keeper for vital upgrades.[/indent]

[b][color=#ff5555]üí• THE GOAL[/color][/b]
[center]The final fight will test all your upgrades against the King's corruption attacks.
[b]Good luck, Unit-07. Restore the system.[/b][/center]
\"\"\"

func _ready():
	# Manually find nodes with error handling
	continue_button = get_node_or_null(\"Panel/Button\")
	story_label = get_node_or_null(\"Panel/RichTextLabel\")
	
	# Debug: Check if nodes were found
	if not continue_button:
		print(\"ERROR: Could not find Panel/Button\")
		# Try alternate paths
		continue_button = get_node_or_null(\"Button\")
		if continue_button:
			print(\"Found Button at root level\")
	
	if not story_label:
		print(\"ERROR: Could not find Panel/RichTextLabel\")
		# Try alternate paths
		story_label = get_node_or_null(\"RichTextLabel\")
		if story_label:
			print(\"Found RichTextLabel at root level\")
	
	# Set the text if label exists
	if story_label:
		story_label.text = STORY_TEXT
		print(\"Story text set successfully\")
	else:
		print(\"CRITICAL ERROR: story_label is still null!\")
	
	# Connect button if it exists
	if continue_button:
		continue_button.pressed.connect(_on_continue_button_pressed)
		print(\"Continue button connected\")
	else:
		print(\"CRITICAL ERROR: continue_button is still null!\")

func _on_continue_button_pressed():
	print(\"Continue button pressed - closing popup\")
	# 1. Emit the signal so the main script knows to start the game
	popup_closed.emit()
	
	# 2. Remove the popup from the scene
	queue_free()
"

[node name="StoryPopup" type="CanvasLayer"]
script = SubResource("GDScript_c65jr")

[node name="ColorRect" type="ColorRect" parent="."]
offset_right = 794.0
offset_bottom = 474.0

[node name="Panel" type="Panel" parent="."]
offset_right = 847.0
offset_bottom = 564.0

[node name="Button" type="Button" parent="."]
offset_left = 652.0
offset_top = 415.0
offset_right = 742.0
offset_bottom = 446.0
text = "Play Game"

[node name="RichTextLabel" type="RichTextLabel" parent="."]
offset_left = 30.0
offset_top = 29.0
offset_right = 70.0
offset_bottom = 69.0
